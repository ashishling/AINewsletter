let y={pending:[],shortlisted:[],rejected:[]},S=[],j={},A=null,p=null,P="articles",d="shortlisted";const Y=["pending","shortlisted","rejected"];let w=null;const g={pending:0,shortlisted:0,rejected:0};let x="domain_asc";const z="curator_reading_metrics_v1",Q=60,fe=5e3;let f={monthly_seconds:{},daily_seconds:{}},B=null,b=null;async function ye(){De(),de(),await h(),await k(),F()}async function h(){try{const n=await(await fetch("/api/articles")).json();y={pending:[],shortlisted:[],rejected:[]},n.articles.forEach(t=>{const s=t.status||"pending";y[s]&&y[s].push(t)}),R(),te(),await he()}catch{o("Failed to load articles","error")}}async function he(){try{const n=await(await fetch("/api/stats")).json();document.getElementById("stat-total").textContent=n.total,document.getElementById("stat-pending").textContent=n.pending,document.getElementById("stat-shortlisted").textContent=n.shortlisted,document.getElementById("stat-rejected").textContent=n.rejected}catch(e){console.error("Failed to load stats:",e)}}function ve(e){P=e,document.getElementById("tab-articles").classList.toggle("active",e==="articles"),document.getElementById("tab-subscriptions").classList.toggle("active",e==="subscriptions"),document.getElementById("articles-view").classList.toggle("active",e==="articles"),document.getElementById("subscriptions-view").classList.toggle("active",e==="subscriptions"),F()}async function k(){const e=document.getElementById("subscriptions-list"),n=document.getElementById("subscriptions-count");try{S=(await(await fetch("/api/rss-subscriptions")).json()).subscriptions||[],n.textContent=`${S.length} subscriptions`,V()}catch{e.innerHTML='<div class="empty-state"><p>Failed to load subscriptions</p></div>',n.textContent="Error loading subscriptions"}}function ge(){const e=document.getElementById("subscriptions-sort");x=e?e.value:"domain_asc",V()}function V(){const e=document.getElementById("subscriptions-list");if(!S.length){e.innerHTML='<div class="empty-state"><p>No active subscriptions found.</p></div>';return}const n=[...S];x==="articles_desc"?n.sort((t,s)=>(s.article_count||0)-(t.article_count||0)):x==="articles_asc"?n.sort((t,s)=>(t.article_count||0)-(s.article_count||0)):n.sort((t,s)=>(t.domain||"").localeCompare(s.domain||"")),e.innerHTML=n.map((t,s)=>{const i=`subscription-feed-${s}`,a=t.updated_at||t.discovered_at,r=encodeURIComponent(t.domain||"");return`
                    <div class="subscription-item">
                        <div class="subscription-top">
                            <div class="subscription-domain">${m(t.domain)}</div>
                            <div class="subscription-meta">${t.article_count||0} articles in feed</div>
                        </div>
                        <div class="subscription-meta" style="margin-bottom: 8px;">
                            ${a?`Updated: ${new Date(a).toLocaleString()}`:"No update timestamp"}
                        </div>
                        <div class="subscription-edit">
                            <input id="${i}" type="url" value="${m(t.feed_url||"")}" placeholder="https://example.com/feed.xml" />
                            <div class="subscription-actions">
                                <button class="btn btn-success" onclick="saveSubscriptionByEncoded('${r}', '${i}')">Save</button>
                                <button class="btn btn-danger" onclick="removeSubscriptionByEncoded('${r}', false)">Remove Subscription</button>
                                <button class="btn btn-warning" onclick="removeSubscriptionByEncoded('${r}', true)">Remove + Delete Articles</button>
                            </div>
                        </div>
                    </div>
                `}).join("")}function W(e){try{return decodeURIComponent(e||"")}catch{return""}}function we(e,n){const t=W(e);if(!t){o("Invalid subscription domain","error");return}be(t,n)}async function be(e,n){const t=document.getElementById(n).value.trim();if(!t){o("Feed URL cannot be empty","error");return}try{const s=await fetch(`/api/rss-subscriptions/${encodeURIComponent(e)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({feed_url:t})}),i=await s.json();if(!s.ok){o(i.error||"Failed to update subscription","error");return}o(`Subscription updated: ${e}`,"success"),await k()}catch{o("Failed to update subscription","error")}}function Ee(e,n){const t=W(e);if(!t){o("Invalid subscription domain","error");return}$e(t,n)}async function $e(e,n){const t=n?`Remove ${e} and delete all related articles from the feed?`:`Remove ${e} subscription?`;if(confirm(t))try{const s=`/api/rss-subscriptions/${encodeURIComponent(e)}?delete_articles=${n?"true":"false"}`,i=await fetch(s,{method:"DELETE"}),a=await i.json();if(!i.ok){o(a.error||"Failed to remove subscription","error");return}n?(o(`Removed ${e} and deleted ${a.deleted_articles||0} articles`,"success"),await h()):o(`Removed ${e} subscription`,"success"),await k()}catch{o("Failed to remove subscription","error")}}async function X(e){if(!["pending","shortlisted","rejected"].includes(e)){o("Invalid status","error");return}const n=e.charAt(0).toUpperCase()+e.slice(1);if(!confirm(`Archive all ${n.toLowerCase()} articles?`))return;const t=document.getElementById("queue-list");t&&(g[d]=t.scrollTop);try{const s=await fetch("/api/archive-status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:e})}),i=await s.json();if(!s.ok){o(i.error||"Failed to archive","error");return}o(`Archived ${i.archived_count} ${e} article(s)`,"success"),await h()}catch{o("Failed to archive","error")}}async function Se(){await X(d)}async function ke(){const e=document.getElementById("pull-feeds-btn"),n=e?e.textContent:"";e&&(e.disabled=!0,e.textContent="Pulling..."),o("Pulling feeds... this may take a minute","success");try{const t=await fetch("/api/sync-feeds",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({full_sync:!1,discover:!1})}),s=await t.json();if(!t.ok){o(s.error||"Failed to pull feeds","error");return}o(`Pulled feeds: ${s.stored_count||0} article(s) stored`,"success"),await h(),await k()}catch{o("Failed to pull feeds","error")}finally{e&&(e.disabled=!1,e.textContent=n||"Pull From Feeds")}}async function Te(){document.getElementById("archives-modal").classList.add("active"),await Ie(),await ee()}function Z(){document.getElementById("archives-modal").classList.remove("active")}async function Ie(){try{const n=await(await fetch("/api/archived/weeks")).json(),t=document.getElementById("archive-week-filter");t.innerHTML='<option value="">All weeks</option>'+n.weeks.map(s=>`<option value="${s.week}">${s.week} (${s.shortlisted} shortlisted, ${s.rejected} rejected)</option>`).join("")}catch(e){console.error("Failed to load archive weeks:",e)}}async function ee(){const e=document.getElementById("archive-week-filter").value,n=document.getElementById("archived-list"),t=document.getElementById("archive-count");try{const s=e?`/api/archived?week=${e}`:"/api/archived",a=await(await fetch(s)).json();if(t.textContent=`${a.count} archived articles`,a.articles.length===0){n.innerHTML='<div class="empty-state"><p>No archived articles</p></div>';return}n.innerHTML=a.articles.map(r=>`
                    <div class="archived-item">
                        <div class="archived-item-info">
                            <div class="archived-item-title">
                                <a href="${m(r.url)}" target="_blank">${m(r.title)}</a>
                            </div>
                            <div class="archived-item-meta">
                                <span class="status-badge status-${r.status}">${r.status}</span>
                                <span>${r.source}</span>
                                <span>Week: ${r.week}</span>
                                <span>Archived: ${new Date(r.archived_at).toLocaleDateString()}</span>
                            </div>
                        </div>
                        <div class="archived-item-actions">
                            <button class="btn btn-primary" onclick="unarchiveArticle('${r.id}')" style="padding: 4px 10px; font-size: 0.75rem;">Unarchive</button>
                        </div>
                    </div>
                `).join("")}catch{n.innerHTML='<div class="empty-state"><p>Failed to load archives</p></div>'}}async function Be(e){try{(await(await fetch(`/api/articles/${e}/unarchive`,{method:"POST"})).json()).success?(o("Article unarchived","success"),await ee(),await h()):o("Failed to unarchive","error")}catch{o("Failed to unarchive","error")}}function Le(e){if(!Y.includes(e))return;const n=document.getElementById("queue-list");n&&(g[d]=n.scrollTop),d=e,R({preserveScroll:!0,animate:!1}),te()}function _(){return y[d]||[]}function R(e={}){const n=e.preserveScroll!==!1,t=e.animate!==!1;Y.forEach(r=>{const c=document.getElementById(`count-${r}`),l=document.getElementById(`queue-filter-${r}`),u=(y[r]||[]).length;c&&(c.textContent=u),l&&l.classList.toggle("active",d===r)});const s=document.getElementById("queue-list"),i=s?s.scrollTop:0,a=_();if(!a.length){s.innerHTML=`<div class="empty-state"><p>No ${d} articles</p></div>`,g[d]=0;return}if(s.innerHTML=a.map((r,c)=>{const l=r.id===p,u=r.summary?r.summary.length>120?r.summary.substring(0,120)+"...":r.summary:"",v=t?`animation-delay: ${Math.min(c*28,280)}ms;`:"animation: none; opacity: 1; transform: translateY(0);";return`
                    <article class="queue-item ${l?"active":""}" data-article-id="${r.id}" tabindex="0" style="${v}" onclick="openReader('${r.id}')">
                        <div class="queue-item-top">
                            <h3 class="queue-item-title">${m(r.title)}</h3>
                            ${r.top_pick?'<span class="queue-pill top-pick">Top Pick</span>':""}
                        </div>
                        <div class="queue-item-meta">
                            <span class="queue-pill source">${m(r.source)}</span>
                            ${r.topic?`<span class="queue-pill topic">${m(r.topic)}</span>`:""}
                        </div>
                        ${u?`<p class="queue-item-summary">${m(u)}</p>`:""}
                        <div class="queue-item-actions">
                            ${_e(r.id,d)}
                        </div>
                    </article>
                `}).join(""),s){const r=g[d]||i||0;s.scrollTop=n?r:0}}function _e(e,n){return n==="pending"?`
                    <button class="btn btn-success" onclick="event.stopPropagation(); curate('${e}', 'shortlisted')">Shortlist</button>
                    <button class="btn btn-danger" onclick="event.stopPropagation(); curate('${e}', 'rejected')">Reject</button>
                    <button class="btn btn-feed-remove" onclick="event.stopPropagation(); removeFeedForArticle('${e}', true)">Remove Feed</button>
                `:n==="shortlisted"?`
                    <button class="btn btn-secondary" onclick="event.stopPropagation(); curate('${e}', 'pending')">Reset</button>
                    <button class="btn btn-danger" onclick="event.stopPropagation(); curate('${e}', 'rejected')">Reject</button>
                    <button class="btn btn-feed-remove" onclick="event.stopPropagation(); removeFeedForArticle('${e}', true)">Remove Feed</button>
                `:`
                <button class="btn btn-secondary" onclick="event.stopPropagation(); curate('${e}', 'pending')">Reset</button>
                <button class="btn btn-success" onclick="event.stopPropagation(); curate('${e}', 'shortlisted')">Shortlist</button>
                <button class="btn btn-feed-remove" onclick="event.stopPropagation(); removeFeedForArticle('${e}', true)">Remove Feed</button>
            `}function te(){const e=_();if(!e.length){ce();return}if(!e.some(t=>t.id===p)){const t=typeof w=="number"?Math.min(w,e.length-1):0;w=null,L(e[t].id,{refreshQueue:!1,animatedSwitch:!0});return}w=null,L(p,{refreshQueue:!1,animatedSwitch:!1})}async function $(e,n){try{const s=_().findIndex(r=>r.id===e);s>=0&&(w=s);const i=document.getElementById("queue-list");i&&(g[d]=i.scrollTop),await Qe(e,n),(await fetch(`/api/articles/${e}/curate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:n})})).ok?(await h(),o(`Article ${n}`,"success")):o("Failed to update article","error")}catch{o("Failed to update article","error")}}async function ne(e,n){try{(await fetch(`/api/articles/${e}/top-pick`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({top_pick:n})})).ok?(await h(),o(n?"Marked as Top Pick":"Top Pick removed","success")):o("Failed to update Top Pick","error")}catch{o("Failed to update Top Pick","error")}}function N(e){return(e||"").toLowerCase().replace(/^www\./,"")}function U(e){if(!e)return"";try{return N(new URL(e).hostname)}catch{return""}}function Fe(e){const n=N(e?.source||""),t=U(e?.url||""),s=[n,t].filter(Boolean);if(!s.length)return"";const i=S.find(a=>{const r=N(a.domain||""),c=U(a.feed_url||"");return s.some(l=>l===r||l===c)});return i?i.domain:""}async function se(e,n=!0){const t=ae(e);if(!t){o("Article not found","error");return}S.length||await k();const s=Fe(t);if(!s){o("Could not map article to an RSS subscription","error");return}const i=n?`Remove feed "${s}" and delete all related articles?`:`Remove feed "${s}" subscription?`;if(!confirm(i))return;const r=_().findIndex(l=>l.id===e);r>=0&&(w=r);const c=document.getElementById("queue-list");c&&(g[d]=c.scrollTop);try{const l=`/api/rss-subscriptions/${encodeURIComponent(s)}?delete_articles=${n?"true":"false"}`,u=await fetch(l,{method:"DELETE"}),v=await u.json();if(!u.ok){o(v.error||"Failed to remove feed subscription","error");return}o(n?`Removed ${s} and deleted ${v.deleted_articles||0} related articles`:`Removed ${s} subscription`,"success"),await k(),await h()}catch{o("Failed to remove feed subscription","error")}}function Re(e,n){E("saving","Saving notes..."),j[e]&&clearTimeout(j[e]),A&&clearTimeout(A),j[e]=setTimeout(async()=>{try{if(!(await fetch(`/api/articles/${e}/curate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notes:n})})).ok)throw new Error("Failed to save notes");E("saved","Saved"),A=setTimeout(()=>{E("idle","Notes auto-save as you type.")},1400)}catch(t){console.error("Failed to save notes:",t),E("error","Save failed. Retrying on next edit.")}},500)}async function Ce(){if(y.shortlisted.length===0){o("No shortlisted articles to include","error");return}o("Generating newsletter...","success");try{const t=await(await fetch("/api/generate-newsletter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})})).json();t.success?(o(`Newsletter generated with ${t.article_count} articles`,"success"),oe(t.newsletter_id)):o(t.error||"Failed to generate newsletter","error")}catch{o("Failed to generate newsletter","error")}}async function oe(e=null){const n=document.getElementById("newsletter-modal"),t=document.getElementById("newsletter-list"),s=document.getElementById("newsletter-content");n.classList.add("active"),t.innerHTML='<h3>Past Newsletters</h3><div class="loading">Loading...</div>';try{const a=await(await fetch("/api/newsletters")).json();if(a.newsletters.length===0){t.innerHTML='<h3>Past Newsletters</h3><div class="empty-state"><p>No newsletters generated yet.</p></div>',s.innerHTML='<div class="empty-state"><p>Shortlist some articles and click "Generate Newsletter".</p></div>';return}t.innerHTML="<h3>Past Newsletters</h3>"+a.newsletters.map(c=>`
                        <div class="newsletter-item" data-id="${c.id}"
                             onclick="loadNewsletterContent('${c.id}')">
                            <span>${c.week}</span>
                            <span style="font-size: 0.8rem; opacity: 0.7;">${new Date(c.generated_at).toLocaleString()}</span>
                        </div>
                    `).join("");const r=e||a.newsletters[0].id;await re(r)}catch{t.innerHTML='<h3>Past Newsletters</h3><div class="empty-state"><p>Failed to load newsletters.</p></div>'}}async function re(e){const n=document.getElementById("newsletter-content");n.innerHTML='<div class="loading">Loading...</div>',document.querySelectorAll(".newsletter-item").forEach(t=>{t.classList.toggle("active",t.dataset.id===e)});try{const t=await fetch(`/api/newsletter/${e}`);if(t.ok){const s=await t.json();n.innerHTML=Ue(s.content)}else n.innerHTML='<div class="empty-state"><p>Newsletter not found.</p></div>'}catch{n.innerHTML='<div class="empty-state"><p>Failed to load newsletter.</p></div>'}}function ie(){document.getElementById("newsletter-modal").classList.remove("active")}function je(){document.getElementById("add-article-modal").classList.add("active"),document.getElementById("article-url").focus()}function ae(e){return[...y.pending,...y.shortlisted,...y.rejected].find(t=>t.id===e)}function L(e,n={}){const t=ae(e);if(!t){o("Article not found","error");return}const s=n.refreshQueue!==!1,i=n.animatedSwitch!==!1;if(p=e,s&&R({preserveScroll:!0,animate:!1}),i){const I=document.querySelector(".reader-panel");I&&(I.classList.remove("reader-switching"),I.offsetWidth,I.classList.add("reader-switching"),setTimeout(()=>I.classList.remove("reader-switching"),220))}const a=document.getElementById("reader-title"),r=document.getElementById("reader-meta"),c=document.getElementById("reader-open-link"),l=document.getElementById("reader-iframe"),u=document.getElementById("reader-notes-input"),v=document.getElementById("reader-reset"),pe=document.getElementById("reader-remove-feed"),C=document.getElementById("reader-top-pick"),T=t.status||"pending";a.textContent=t.title||"Article",r.innerHTML=`
                <span>${m(t.source||"")}</span>
                ${t.topic?`<span>Topic: ${m(t.topic)}</span>`:""}
                <span>Status: ${m(T)}</span>
            `,c.href=t.url,l.src=t.url,u.value=t.user_notes||"",u.oninput=()=>Re(e,u.value),E("idle","Notes auto-save as you type.");const H=document.getElementById("reader-shortlist"),O=document.getElementById("reader-reject");H.style.display=T==="shortlisted"?"none":"inline-flex",O.style.display=T==="rejected"?"none":"inline-flex",v.style.display=T==="pending"?"none":"inline-flex",C.style.display=T==="shortlisted"?"inline-flex":"none",C.classList.toggle("active",!!t.top_pick),H.onclick=async()=>{await $(e,"shortlisted")},O.onclick=async()=>{await $(e,"rejected")},v.onclick=async()=>{await $(e,"pending")},pe.onclick=async()=>{await se(e,!0)},C.onclick=async()=>{await ne(e,!t.top_pick)},F()}function ce(){document.getElementById("reader-title").textContent="Select an article",document.getElementById("reader-meta").innerHTML="",document.getElementById("reader-iframe").src="about:blank",document.getElementById("reader-notes-input").value="",document.getElementById("reader-open-link").removeAttribute("href"),E("idle","Notes auto-save as you type."),p=null,R({preserveScroll:!0,animate:!1}),F()}function q(){document.getElementById("add-article-modal").classList.remove("active"),document.getElementById("add-article-form").reset()}async function Ae(){const e=document.getElementById("article-url").value.trim();if(!e){o("Please enter a URL first","error");return}o("Fetching article metadata...","success");try{const t=await(await fetch("/api/fetch-url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})})).json();t.success?(t.title&&(document.getElementById("article-title").value=t.title),t.summary&&(document.getElementById("article-summary").value=t.summary),o("Metadata fetched!","success")):o("Could not fetch metadata: "+(t.error||"Unknown error"),"error")}catch{o("Failed to fetch metadata","error")}}async function Me(e){e.preventDefault();const n=document.getElementById("article-url").value.trim(),t=document.getElementById("article-title").value.trim();if(!n||!t){o("URL and title are required","error");return}try{const i=await(await fetch("/api/articles/manual",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:n,title:t,summary:document.getElementById("article-summary").value.trim(),topic:document.getElementById("article-topic").value,notes:document.getElementById("article-notes").value.trim(),auto_shortlist:document.getElementById("article-shortlist").checked})})).json();i.success?(o("Article added successfully!","success"),q(),await h()):o(i.error||"Failed to add article","error")}catch{o("Failed to add article","error")}}function xe(e){if(P!=="articles"||e.metaKey||e.ctrlKey||e.altKey)return;const n=e.target;if(n&&["INPUT","TEXTAREA","SELECT"].includes(n.tagName))return;const t=_();if(!t.length)return;const s=t.findIndex(a=>a.id===p),i=s>=0?s:0;if(e.key==="j"||e.key==="J"){e.preventDefault();const a=Math.min(t.length-1,i+1);L(t[a].id);return}if(e.key==="k"||e.key==="K"){e.preventDefault();const a=Math.max(0,i-1);L(t[a].id);return}if(p){if(e.key==="s"||e.key==="S"){e.preventDefault(),$(p,"shortlisted");return}if(e.key==="r"||e.key==="R"){e.preventDefault(),$(p,"rejected");return}(e.key==="n"||e.key==="N")&&(e.preventDefault(),document.getElementById("reader-notes-input").focus())}}function D(e=new Date){const n=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${n}-${t}-${s}`}function le(e=new Date){const n=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return`${n}-${t}`}function Ne(e){const n=Math.floor((e||0)/60),t=Math.floor(n/60),s=n%60;return t>0?`${t}h ${s}m`:`${s}m`}function De(){try{const e=localStorage.getItem(z);if(!e)return;const n=JSON.parse(e);f={monthly_seconds:n.monthly_seconds||{},daily_seconds:n.daily_seconds||{}}}catch{f={monthly_seconds:{},daily_seconds:{}}}}function Pe(){try{localStorage.setItem(z,JSON.stringify(f))}catch{}}function qe(){const e=new Date,n=new Date(e);n.setDate(e.getDate()-1);let t=(f.daily_seconds[D(e)]||0)>=Q?new Date(e):new Date(n),s=0;for(let i=0;i<366;i+=1){const a=D(t);if((f.daily_seconds[a]||0)<Q)break;s+=1,t.setDate(t.getDate()-1)}return s}function de(){const e=f.monthly_seconds[le()]||0,n=qe(),t=document.getElementById("metric-reading-time"),s=document.getElementById("metric-reading-streak");t&&(t.textContent=Ne(e)),s&&(s.textContent=String(n))}function He(e){if(!e||e<=0)return;const n=Math.min(e,20),t=le(),s=D();f.monthly_seconds[t]=(f.monthly_seconds[t]||0)+n,f.daily_seconds[s]=(f.daily_seconds[s]||0)+n,Pe(),de()}function ue(){if(!b){b=Date.now();return}const e=Date.now(),n=Math.round((e-b)/1e3);b=e,He(n)}function Oe(){B||(b=Date.now(),B=setInterval(ue,fe))}function me(){B&&(clearInterval(B),B=null,ue(),b=null)}function F(){P==="articles"&&!!p&&document.visibilityState==="visible"?Oe():me()}function E(e,n){const t=document.getElementById("notes-save-status");t&&(t.className=`notes-save-status ${e}`,t.textContent=n)}async function Qe(e,n){const t=document.querySelector(`.queue-item[data-article-id="${e}"]`);t&&(t.classList.remove("status-shift-shortlisted","status-shift-rejected","status-shift-pending"),t.classList.add(`status-shift-${n}`),await new Promise(s=>setTimeout(s,170)))}function Ue(e){return e?e.replace(/^### \[(.*?)\]\((.*?)\)/gm,'<h3><a href="$2" target="_blank">$1</a></h3>').replace(/^## (.*$)/gm,"<h2>$1</h2>").replace(/^# (.*$)/gm,"<h1>$1</h1>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^> (.*$)/gm,"<blockquote>$1</blockquote>").replace(/^- (.*$)/gm,"<li>$1</li>").replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>").replace(/^---$/gm,"<hr>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>"):""}function m(e){const n=document.createElement("div");return n.textContent=e||"",n.innerHTML}function o(e,n="success"){const t=document.querySelector(".toast");t&&t.remove();const s=document.createElement("div");s.className=`toast ${n}`,s.textContent=e,document.body.appendChild(s),setTimeout(()=>s.remove(),3e3)}const J=document.getElementById("newsletter-modal");J&&J.addEventListener("click",e=>{e.target.classList.contains("modal")&&ie()});const K=document.getElementById("add-article-modal");K&&K.addEventListener("click",e=>{e.target.classList.contains("modal")&&q()});const G=document.getElementById("archives-modal");G&&G.addEventListener("click",e=>{e.target.classList.contains("modal")&&Z()});document.addEventListener("keydown",xe);document.addEventListener("visibilitychange",F);window.addEventListener("beforeunload",me);const M=document.getElementById("queue-list");M&&M.addEventListener("scroll",()=>{g[d]=M.scrollTop});window.archiveCurrentFolder=Se;window.archiveStatus=X;window.closeAddArticle=q;window.closeArchives=Z;window.closeModal=ie;window.closeReader=ce;window.curate=$;window.fetchMetadata=Ae;window.generateNewsletter=Ce;window.loadNewsletterContent=re;window.openAddArticle=je;window.openArchives=Te;window.onSubscriptionsSortChange=ge;window.openReader=L;window.pullFromFeeds=ke;window.removeFeedForArticle=se;window.removeSubscriptionByEncoded=Ee;window.saveSubscriptionByEncoded=we;window.setQueueStatus=Le;window.submitArticle=Me;window.switchView=ve;window.toggleTopPick=ne;window.unarchiveArticle=Be;window.viewNewsletter=oe;ye();
